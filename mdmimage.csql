WITH fake_data AS (
  SELECT [
    STRUCT('1' as mdmId, null as mdmTenantId, "" as mdmEntityType, 0 as mdmCounterForEntity, 'test 1' AS mdmname, 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCARXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAKgAgAEAAAAAQAAAGCgAwAEAAAAAQAAAEgAAAAA/+EKCWh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHBob3Rvc2hvcDpUcmFuc21pc3Npb25SZWZlcmVuY2U9Il9YVERESUVCbWEzQno4bUJQdFVKIiBwaG90b3Nob3A6SW5zdHJ1Y3Rpb25zPSJGQk1EMDEwMDBhYzAwMzAwMDAyYTIzMDAwMDE2NGYwMDAwNDk1MTAwMDBjNzUzMDAwMGRhNzIwMDAwMDRiMjAwMDAyNWJhMDAwMDVlYmQwMDAwYjBjMTAwMDBmMDI3MDEwMCIvPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg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' AS mdmdocument)
  ] AS image
),
pictures AS (
  SELECT 
    --'e9da7834c1f646019567ff9a079638d7' as mdmTenantId,
      mdmId,
      mdmname,
      mdmdocument,
      mdmname
      --metadata--
  FROM
    fake_data,
    UNNEST(image) AS stg
  WHERE 1=1
  --timestamp-- and stg.mdmCounterForEntity > {{start_from}}
  --tenantIds-- and mdmTenantId IN {{tenantIds}}
)
SELECT
  *--, (mdmId IS NULL OR LENGTH(TRIM(mdmId)) = 0) AS mdmDeleted
FROM
  pictures
